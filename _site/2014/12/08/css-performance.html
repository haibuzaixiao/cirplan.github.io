
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    
    <title>译.css性能 | 萝拔</title>
    
    
    <meta name="author" content="dcirplan">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    
      <link href="/assets/themes/twitter/css/style.min.css?body=1" rel="stylesheet" type="text/css" media="all">
    
    
    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/favicon.ico">
  <!-- Update these with your own images
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
    <!-- <script type="text/javascript" src="/assets/themes/twitter/js/jquery-2.1.1.min.js"></script> -->
    <script type="text/javascript" src="/assets/themes/twitter/js/prettify.js"></script>
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">萝拔</a>
          <ul class="nav">
            
            
            


  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">归档</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">分类</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">标签</a></li>
      	
      
    
  




            <li class="divider-vertical"></li>
            
            
            


  
    
      
    
  
    
      
      	
      	<li><a href="/about.html">关于</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  





           <!--  <li><a href="http://feed.zhuoqun.net/">订阅</a></li> -->
          </ul>

          <span class="pull-right slogan"> 业精于勤荒于嬉 行成于思毁于随 </span>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        
<div class="row post">
  <div class="span11">
    <h1 class="title">译.css性能</h1>
    <div class="date f-c-b">Date：<span>08 December 2014</span></div>
    
    <div class="tag-n">Tag
      <ul class="tag_box">
      
      


  
     
    	<li><a href="/tags.html#css-ref">css <span>5</span></a></li>
     
    	<li><a href="/tags.html#翻译-ref">翻译 <span>3</span></a></li>
    
  



      </ul>
     
      </div>
    
<p>原文：<a href="https://dl.dropboxusercontent.com/u/39519/talks/cssperf/index.html">CSS Performance</a>（2011年文章，有着很赞的翻转效果，前提是祭出高级浏览器）</p>

<p><strong>目录</strong></p>

<ol>
  <li>Reflows（重排）</li>
  <li>Hardware Accelerated Css（硬件加速css）</li>
  <li>Avoiding Expensive Css（避免高消耗css）</li>
  <li>Selector Perf（选择器性能）</li>
  <li>Style Matching Perf（样式匹配性能）</li>
  <li>Polyfills</li>
  <li>Debugging（调试）</li>
</ol>

<h2 id="section"><strong>1. 重排</strong></h2>
<p>先来看看html页面的渲染、绘制流程图</p>

<p><img src="/images/render.png" alt="render" /></p>

<ol>
  <li>根据<code>Html</code>标签生成<code>Dom</code>树（<code>Dom tree</code>）；根据默认的，用户自定义的样式生成样式结构（<code>Styles struct</code>）</li>
  <li>生成渲染树（<code>Render tree</code>）</li>
  <li>绘制页面</li>
</ol>

<p>下面是重排的渲染短视频：</p>

<video controls="" preload="" autobuffer="" width="860" height="510">
	<source src="https://dl.dropboxusercontent.com/u/39519/talks/cssperf/assets/geckoreflow-mozillaorg.mp4" type="video/mp4" />
	<source src="https://dl.dropboxusercontent.com/u/39519/talks/cssperf/assets/geckoreflow-mozillaorg.webm" type="video/webm" />
</video>

<p>下面，先看看重绘机制：如何（不）触发<code>WebKit</code>的布局（<a href="http://gent.ilcore.com/2011/03/how-not-to-trigger-layout-in-webkit.html">How (not) to trigger a layout in WebKit</a>）（2011）。</p>

<p>简单译文：</p>

<p>许多<code>Web</code>开发者意识到，一段<code>js</code>脚本在运行的时候，是在触发<code>DOM</code>的操作而不是执行代码本身。这样一个潜在消耗时间，从<code>Dom</code>树构建渲染树（<code>Render tree</code>）的过程，被称作布局（又称重排）。约庞大越复杂的<code>Dom</code>树，就会消耗更多的时间。</p>

<p>一个很重要的方法让页面的不假死，就是让分开的Dom操作放在一起。</p>

<p>ex: </p>

<pre><code>// 一般，触发两次布局
var newWidth = aDiv.offsetWidth + 10; // Read
aDiv.style.width = newWidth + 'px'; // Write
var newHeight = aDiv.offsetHeight + 10; // Read
aDiv.style.height = newHeight + 'px'; // Write

// 更好, 只触发一次布局
var newWidth = aDiv.offsetWidth + 10; // Read
var newHeight = aDiv.offsetHeight + 10; // Read
aDiv.style.width = newWidth + 'px'; // Write
aDiv.style.height = newHeight + 'px'; // Write
</code></pre>

<p>然后这里就会有个问题：什么情况会触发布局？下面是整理的一些元素和方法：</p>

<pre><code>Element
clientHeight, clientLeft, clientTop, clientWidth, focus(), getBoundingClientRect(), getClientRects(), innerText, offsetHeight, offsetLeft, offsetParent, offsetTop, offsetWidth, outerText, scrollByLines(), scrollByPages(), scrollHeight, scrollIntoView(), scrollIntoViewIfNeeded(), scrollLeft, scrollTop, scrollWidth

Frame, Image
height, width

Range
getBoundingClientRect(), getClientRects()

SVGLocatable
computeCTM(), getBBox()

SVGTextContent
getCharNumAtPosition(), getComputedTextLength(), getEndPositionOfChar(), getExtentOfChar(), getNumberOfChars(), getRotationOfChar(), getStartPositionOfChar(), getSubStringLength(), selectSubString()

SVGUse
instanceRoot

window
getComputedStyle(), scrollBy(), scrollTo(), scrollX, scrollY, webkitConvertPointFromNodeToPage(), webkitConvertPointFromPageToNode()
</code></pre>

<p>当然列出的这些不是全部，这只是一个很好的开始。最好的方法是通过Chrome或者Firefox浏览器的调试器去查看。（翻译完）</p>

<p>好的，再回到这里，我们看看什么动作会触发重排。</p>

<ul>
  <li>增加，删除，更新<code>Dom</code>节点。</li>
  <li>通过<code>display:none</code>隐藏元素。</li>
  <li>对页面上的<code>Dom</code>元素进行移动等动画。</li>
  <li>增加样式，或调整样式属性。</li>
  <li>用户改变窗口大小，改变字体大小，或者滚动页面。</li>
</ul>

<h3 id="section-1">策略：</h3>
<ul>
  <li>在触发重排动作前，对<code>Dom</code>进行批量操作。</li>
  <li>复制节点的属性，在复制的节点里进行操作，在一次交换过来。</li>
  <li>先用<code>display:none</code>隐藏节点，再进行大量的操作，再通过<code>display</code>显示。</li>
</ul>

<p>更多重排文章：</p>

<p><a href="http://www.phpied.com/rendering-repaint-reflowrelayout-restyle/">Stoyan Stefanov on Reflow/Repaint</a></p>

<p><a href="http://calendar.perfplanet.com/2009/the-new-game-show-will-it-reflow/">The new game show: “Will it reflow?”</a></p>

<p><a href="http://www.browserscope.org/?category=reflow">Mozilla’s David Baron on Browser Internals for Web Developers</a></p>

<p><a href="https://www.youtube.com/watch?v=a2_6bGNZ7bA">WebKit blog five-part series on rendering</a></p>

<h2 id="css"><strong>2.硬件加速css</strong></h2>

<p>充分利用<code>Css</code>的<code>transitions</code>和<code>transforms</code>达到最优的质量。
这方面主要应用于手机，ios和Android</p>

<video controls="" preload="" autobuffer="" width="860" height="310">
	<source src="https://dl.dropboxusercontent.com/u/39519/talks/cssperf/assets/translate3d.mp4" type="video/mp4" />
	<source src="https://dl.dropboxusercontent.com/u/39519/talks/cssperf/assets/translate3d.webm" type="video/webm" />
</video>

<h2 id="css-1"><strong>3.避免高消耗css</strong></h2>

<ul>
  <li>@font-face </li>
  <li>box-shadow </li>
  <li>opacity compositing </li>
  <li>gradients </li>
  <li>text-align</li>
</ul>

<p>(这部分待续…)</p>

<h2 id="section-2"><strong>4.选择器性能</strong></h2>

<p>浏览器默认是从右到左。</p>

<p>下面选择器引擎是从左到右：</p>

<ul>
  <li>Mootools</li>
  <li>Sly</li>
  <li>Peppy</li>
  <li>Dojo Acme</li>
  <li>Ext JS</li>
  <li>Prototype.js</li>
</ul>

<p>下面是从右到左：</p>

<ul>
  <li>Sizzle</li>
  <li>YUI 3</li>
  <li>NWMatcher</li>
  <li>querySelectorAll</li>
</ul>

<p>选择器优化</p>

<p>推荐组合是：<code>tag .class</code>，让标签在左边，尽可能让class在右边。</p>

<h2 id="section-3"><strong>5.样式匹配性能</strong></h2>

<p>关于样式匹配，请看<a href="http://screwlewse.com/2010/08/different-css-techniques-and-their-performance/">样式匹配性能</a>。</p>

<h2 id="polyfills"><strong>6.Polyfills</strong></h2>

<p>关于Polyfills的介绍：</p>

<blockquote>
  <p>Polyfilling 是由 RemySharp 提出的一个术语，它是用来描述复制缺少的 API 和API 功能的行为。你可以使用它编写单独应用的代码而不用担心其他浏览器原生是不是支持。实际上，polyfills并不是新技术也不是和 HTML5 捆绑到一起的。我们已经在如json2.js，ie7-js 和为 IE 浏览器提供透明 PNG支持的JS中使用过了。而和现在 polyfills 的区别就是去年增加的 HTML5 polyfills。</p>
</blockquote>

<p>相关信息：</p>

<ul>
  <li><a href="http://selectivizr.com/">Selectivizr</a></li>
  <li><a href="http://css3pie.com/">CSS3Pie</a></li>
  <li><a href="https://github.com/Modernizr/Modernizr/wiki/HTML5-Cross-Browser-Polyfills">Modernizr wiki list of polyfills</a></li>
</ul>

<h2 id="section-4"><strong>7.调试</strong></h2>

<p>主要是手机硬件方面的调试。
相关信息：</p>

<ul>
  <li><a href="http://peter.sh/experiments/chromium-command-line-switches/">All of Chrome’s command line switches</a></li>
  <li><a href="http://mir.aculo.us/2011/02/08/visualizing-webkits-hardware-acceleration/">Thomas Fuchs: Safari and iPhone Simulator CoreAnimation debugging info.</a></li>
  <li><a href="http://www.html5rocks.com/en/tutorials/speed/html5/">HTML5Rocks: Improving the Performance of your HTML5 App</a></li>
</ul>


    <ul class="pager">
    
      <li class="previous"><a href="/2014/12/05/css-specificity-wars.html" title="译.层叠和选择器的明确度--权重">&larr; 译.层叠和选择器的明确度--权重</a></li>
    
    
      <li class="next"><a href="/2014/12/08/css-selector.html" title="译.css选择器渲染优化">译.css选择器渲染优化&rarr;</a></li>
    
    </ul>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    
    var disqus_shortname = 'cirplanblog'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>





    <!-- 多说评论框 start -->
     <!-- <div class="ds-thread" data-thread-key="/2014/12/08/css-performance" data-title="译.css性能" data-url="http://jeffdeng.me/2014/12/08/css-performance.html"></div>-->
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
   <!-- <script type="text/javascript">
    var duoshuoQuery = {short_name:"jeffdeng"};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>-->
    <!-- 多说公共JS代码 end -->

  </div>
  
</div>


      </div>

      <footer>
        <p>&copy; <a href="mailto:dcirplan@gmail.com">dcirplan</a> 2014. 
          Proudly powered by <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div> <!-- /container -->

    <!-- 



 -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-46595250-3', 'auto');
      ga('send', 'pageview');

    </script>

    <script type="text/javascript">
      window.onload = function() {
        var doms = document.querySelectorAll('pre');

        for( var i = 0; i < doms.length; i++ ){
          doms[i].className += ' prettyprint ';
        }
        prettyPrint();
      };
     
    </script>

  </body>
</html>

